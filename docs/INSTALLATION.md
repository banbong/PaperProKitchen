# 설치하기

 * 시작하기 전
 * 준비
   * PC의 기기 인식 여부 확인
   * 도구 다운로드
   * 사용할 이미지 고르기
   * 부가 사항, 몇 가지 더
 * 설치 절차
   * `_step_by_step.cmd` 소개
   * ADB 드라이버 설치
   * 장치 관리자 창 열어두기
   * 기기 완전히 끄기
   * 기기를 Fastboot 모드로 켜기
   * 루트 이미지로 기기 부팅시키기
 * 이후 할 일
   * 정상 부팅될 때까지 기다리기
   * 기본 앱 자동 설치 절차 안내
   * PC 정상 인식 여부 점검
   * 한 번 더 재시작

## 시작하기 전
 * 먼저 기기 소프트웨어를 최신 버전으로 업데이트 후 진행해주세요.
 * MS 윈도 10 기준으로 만들었습니다.
   * 윈도 7에서는 불편한 절차가 추가될 수 있습니다.
   * 맥/리눅스 사용자 분들은 잘.. 하시리라 믿습니다.
 * **기기 연결시 참고사항**
   * **좋은 USB 케이블**을 이용하세요.
   * 데스크탑이면 **후면 포트**가 좋을 수 있습니다.
 * 17년 12월 초판 기기일 경우 앱 설치 공간에서 유리할 수도 있습니다.
   * 전체 8GB 저장 공간 중, 초판은 3GB 가량, 이후 기기는 고작 512MB를 앱 설치 공간으로 할당합니다.
 * 소요 시간으로 **30분** 정도 예상하고 있습니다. 이것저것 문제가 생겨서 이보다 오래 걸리고 있다면, 환경에 문제가 있을 수 있으니 다른 PC에서 시도해보세요.

## 준비

### PC의 기기 인식 여부 확인

USB 케이블로 기기를 PC에 연결하면 다음과 같은지 확인하세요.

* 윈도 탐색기에서 "PAPER PRO" 장치가 뜨는지, 
* 장치로 들어가면 기기에 저장된 파일이 보이는지

<details><summary>인식이 안 된다면:</summary>

 * USB 케이블 교체, PC의 다른 USB 포트 이용
 * 기기 및 PC 재부팅

또는, **윈도 "N" 버전**이면 MTP 기능이 동작하지 않을 수 있습니다. **미디어 기능팩**을 설치해보세요.

</details>

### 도구 다운로드 및 압축 풀기

[릴리스][release] 페이지에서 최신 도구를 다운로드하고, 바탕화면이든 어디든 사용하기 편리한 위치에 압축을 풀어 주세요.

> 저장소 소스 파일을 직접 다운로드하지 마세요! 릴리스 페이지의 최신 압축 파일을 다운로드하세요.

압축을 푼 폴더 안에서 몇 가지 폴더들, 그리고 각종 "cmd" 파일이 있는지 살펴보세요. 곧 사용합니다.

### 적용할 루트 이미지 고르기

> 💬 여기서 말씀드리는 이미지는 그림 파일을 말하는 것이 **아니고**, 기기에서 실행시킬 파일들의 묶음 파일이라고 생각해주세요.  
> ❎ 이미지 파일은 PC에서 안 열립니다!

`images` 폴더 안에 루트 이미지가 준비되어 있습니다. 기호에 맞게 몇 가지 베리에이션을 준비했습니다.

 * 올인원 (권장): 처음 시작하며, 이것저것 떠먹여줬으면 좋겠다면
  ---
 * 라이트 (좀 써보신 분): 처음 시작하지만, 군더더기 없이 앱 실행을 위한 필수 앱만 있으면 좋겠다면
 * 베이직: 소프트웨어 업데이트 후 모종의 이유로 루트 권한이 날아갔거나 하는 경우
 * ADB만: 루트 권한 없이 ADB만 열리면 좋겠다면

예, 올인원 이미지를 사용해주세요. ~답정너~

> 베리에이션별 [상세 수정 사항](/docs/DIFFERENCES.md)

### 부가 사항

#### (윈도 7만) 드라이버 수동 설치 피하기

> ❗ 윈도 7 쓰실 때만 적용하세요!

1. 먼저 루트 도구 폴더에 있는 `.win7` 파일을 보아 주세요. 크기 0인 빈 파일입니다!  
   루트 도구 폴더 아래 `flags` 폴더에 있습니다.

2. 이제 탐색기에서 기기의 내부 저장소를 여시고 ".win7" 파일을 내부 저장소로 복사해 주세요.

<details><summary>상세 설명</summary>

* ADB 장치의 제조사/장치 코드를 (VID/PID)
    기존 네트로닉스 기기(1F85/6056)에서 구글 넥서스 기기(18D1/4EE2)로 변경합니다.

* 5단계 완료 후에도 ".win7" 파일은 삭제되지 않습니다.
      다음 소프트웨어 업데이트 후 루팅 때 쓸 겁니다.

* ADB 장치의 USB VID/PID를 원래대로 되돌리려면 다음 중 한 가지를 수행해 주세요.

  1. 기기 내부 저장소에서 ".win7"파일을 지우고, 대신 ".rev_win7" 파일을 넣어주세요.
    그리고 나서 루팅 이미지로 4-5단계를 한 번 더 진행해주세요.

  2. 직접 순정 부트 이미지로 되돌려도 됩니다.

</details>

#### (필요하신 분만) 'epdblk' 툴 위한 권한 조정

네이버 이북카페 데메빌러님의 'epdblk' 툴 및 RefreshPie 앱을 이용하려는 경우,

루트 도구 폴더 아래 `플래그` 폴더의 `.allow_epdblk` 파일을 위와 비슷하게 내부 저장소로 옮겨주세요.

RefreshPie 앱의 자동 리프레시 기능이 탐나신다면 시도해볼만 할 지 모릅니다.

#### (안 해도 됨) 첫 부팅 시 자동 설치할 앱 넣어두기

> ✅ 나중에 별도로 설치해도 됩니다!  
> ADB만 활성화하는 이미지에서는 동작하지 않습니다.

<details><summary>설명 보기</summary>

 * 설치하려는 앱 APK 파일을 모으고
 * 기기 내부저장소에 `Apps` 폴더를 만들고
 * 그 안에 받은 APK 파일을 넣어주세요

</details>

### 몇 가지 더

 * 혹시 모르니 기기 배터리를 50% 이상 충전해주세요.
 * 기기에 중요한 파일이 있다면 혹시 모르니 PC에 백업해두세요.

## 설치 절차

### `_step_by_step.cmd` 소개

아래 절차를 차례대로 안내합니다.

혹 실행되지 않으면 그냥 아래 절차를 직접 따라주세요.

### ADB 드라이버 설치

도구 폴더 안의 `drivers/GoogleUSBDriver` 폴더로 들어가세요.

 * 윈도 10에서는
   * `android_winusb.inf` 파일에 오른쪽 클릭, 설치 클릭
 * 윈도 7에서는
   * `DPInst_x64.exe` 또는 `DPInst_x86.exe` 실행 후 안내에 따르기

### 장치 관리자 창 열어두기

`_open_devmgmt.cmd`를 실행하면 장치 관리자 창을 띄워드립니다. 이따가 장치 인식 여부 확인할 때 쓰세요.

### 기기 완전히 끄기

> - 아직까지 기기가 USB 케이블로 PC에 연결되어 있지 않다면, 지금 연결해 주세요!
> - 화면 조명을 (=프론트라이트를) 켜 두시길 권합니다. 조명이 꺼지면 완전히 꺼진 거니까요.

- 화면이 켜져 있을 때 전원 버튼 꾹 누르고, 정말 끄겠냐고 물어보면 [확인] 눌러주세요.
- 아니면 전원 버튼을 10초간 꾹 눌러서 강제로 끌 수도 있습니다.

### 기기를 Fastboot 모드로 켜기

이제부터는 기기가 계속 PC에 연결되어 있어야 합니다!

  - 기기 전원이 완전히 꺼진 상태에서,
    전면 우상단 페이지 버튼과 상단 전원 버튼을 함께 누르고 계세요.  
    (기기 우측면에 있는 퀵버튼이 아니에요! 전면입니다.)

    - 간혹 우상단 + 우하단 같이 눌러야 하는 기기가 있다고 합니다.


  - 전원 버튼 좌측 LED에 잠시 초록 불이 들어왔다가,
    (노랑 또는) 흰색으로 바뀌면 버튼에서 손을 떼세요  
    (아직 화면은 바뀌지 않습니다.)  
    (PC와 제대로 연결되어 있지 않으면 흰노랑 불이 꺼지고, 그냥 기기가 정상 부팅됩니다.)

  - 장치 관리자에 "Android Device" > "Android ADB Interface" 장치가 잡혀 있으면 성공입니다.

#### 윈도 7 + 기기 인식되지 않았다면

장치 관리자에서 위의 드라이버를 수동 설치하세요.

### 루트 이미지로 기기 부팅시키기

`_start_cmd.cmd` 파일을 실행하여 명령줄 창을 띄운 뒤 아래 명령을 입력하세요.

 1. `fastboot devices` 명령으로 기기 인식 여부를 확인하세요.
 2. 앞에서 고른 이미지에 해당하는 경로로 다음 명령을 내려주세요.

* 올인원  
`fastboot boot images\openlib_r13_full.img`
* 라이트  
`fastboot boot images\openlib_r13_light.img`
* 베이직  
`fastboot boot images\openlib_r13_basic.img`
* ADB만  
`fastboot boot images\open_adb_only_r1.img`

명령줄 창에 `downloading, booting, finished` 메시지가 차례로 뜬 뒤 `fastboot` 명령이 종료되고 기기가 위 이미지로 부팅됩니다.

> 위의 `fastboot boot` 명령이 실패할 경우, 위의 장치 인식 실패 사례와 마찬가지로
> * USB 케이블 교체, PC측 USB 포트 교체, 재부팅, PC 교체  
> 
> 등을 시도하세요.

> 위 루트 이미지로 부팅 작업은 여러 번 반복 시도할 수 있습니다. 하지만 굳이 일부러 반복하지는 마세요.

## 이후에 할 일

### 정상 부팅될 때까지 기다리기

잠시 기다리면 기기가 몇 번 깜빡인 뒤, "루트 도구 설치 중" 메시지가 뜨고, 30초 쯤 있다가 완료되어 정상 부팅 절차가 시작됩니다.

> 루트 작업 기록은 기기 내부저장소에 `ridi.mod.log` 파일로 기록됩니다.

> * 부팅 중 PC에서 "USB 장치 인식 실패" 오류가 발생할 수 있으나, 예견된 증상입니다. 부팅 완료 시 다시 정상 인식됩니다.  
> * 시스템 공간에 설치한 앱 때문에 처음 부팅 시에만 "업데이트 중" 대화상자가 표시됩니다.

### 기본 앱 자동 설치 절차 안내

부팅이 끝나고 리디 앱 서재 화면이 나타나면 그 때 쯤 기본 앱 설치 절차가 시작됩니다. 화면 하단의 토스트 메시지를 통해 현재 하고 있는 일 확인이 가능합니다.

> 앱 설치 기록은 기기 내부저장소에 `install.apps.log` 파일로 기록됩니다.

그 사이에 기기를 내버려두셔도 좋고, 책을 열고 독서를 하셔도 됩니다.

"설치 완료" 대화상자, 또는 "사용자 앱 자동 설치 기능 안내" 대화상자가 뜨면 설치 작업은 마무리되었습니다.

> 기본 앱 사용법은 이따가 [기본 사용법](/docs/BASIC_USAGE.md) 문서를 참조하세요.

### PC 정상 인식 여부 점검

이제 PC에서 기기에 앱을 설치하거나 각종 관리 작업을 진행하기 위해 ADB 프로그램이 작동하도록 만들겠습니다.

기기가 완전히 켜진 다음, 즉 리디 앱의 서재 화면이 화면에 나타난 다음부터 진행해주세요.

> 부팅 중에는 ADB 기능이 동작하지 않습니다! (PC 화면에 "USB 장치 인식 오류"가 나타날 수 있습니다.)

#### 윈도 탐색기 인식 확인

윈도 탐색기에 "PAPER PRO" 장치가 나타나는지 확인해주세요. 그렇지 않다면 다음 단계의 장치관리자 화면에서 바로잡아야 합니다.

#### 장치 관리자 확인

- 기기가 PC에 연결되어 있을 때 장치 관리자에 다음 두 개 장치가 보여야 합니다!

* 첫 번째로, 윈도 탐색기 인식을 위해 ("MTP 장치")
 "휴대용 장치" > "PAPER PRO"가 있어야 합니다.

* 그리고 ADB 장치로 인식되기 위해
  - **윈도 10**  
 "범용 직렬 버스 장치" > "Ridi_device"가 보이면 됩니다. 장치 이름 및 범주 이름은 다를 수도 있습니다. "기타 장치"만 아니면 돼요.
  - **윈도 7**  
  "Android Device" > "Android Composite ADB Interface" 장치가 잡혀 있으면 성공입니다. 

> 기타 장치에 있다면, 드라이버 수동 설치 절차를 진행하세요.

> 윈도 탐색기에서 안 보인다면,
> * 위에서 언급한 ADB 장치를 찾으세요
> * 해당 장치에서 [오른쪽 클릭 > 드라이버 업데이트]를 선택하세요.
> * 드라이버 수동 설치 절차를 밟되, [디스크 있음] 버튼을 누르지 말고, 검색된 드라이버 목록을 보아주세요.  
> 아마 "MTP 장치" 또는 "USB Composite 장치"가 있을 겁니다.
목록에 보이는 걸 골라서 설치해주세요.

> 윈도 7에서 간혹 정상 부팅 완료 후에도 장치 인식이 전혀 되지 않는 경우, "USB 2.0 드라이버"를 설치해야 한다는 설이 있습니다.

#### PC의 ADB 프로그램이 기기를 인식하는지 보기

  - 앞의 `_start_cmd.cmd`로 여는 명령줄 창에서 아래 명령을 입력했을 때 기기 시리얼 번호와 "device" 문구가 뜨는지 확인하세요  
  `adb devices`

> - 장치관리자에는 보이나, ADB 프로그램에서 인식을 못 하는 경우 (= 장치 목록이 비어 있다면 )  
> `_add_vendor_to_adb_usb_ini.cmd`를 실행 후 다시 시도해보세요.

#### 한 번 더 재시작

기본 앱 설치 완료 후, Xposed Framework 관련 앱 설정이 반영되고 올바르게 동작할 수 있도록 기기 재시작이 필요합니다.

- 전원 버튼을 꾹 눌러 종료 확인창을 띄우고, [확인]을 눌러 종료해주세요.
- 기기 전원이 꺼지면 전원 버튼을 눌러 다시 켜 주세요.

또는

- 앱 서랍 화면을 띄워 주세요.
- [잠금] 버튼을 길게 누르면 전원 메뉴가 뜹니다. [재시작]을 눌러 주세요.



[release]:https://github.com/limerainne/PaperProKitchen/releases
